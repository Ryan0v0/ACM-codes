### hdu 6377 : 度度熊看球赛

[题目链接](http://acm.hdu.edu.cn/showproblem.php?pid=6377)

题解：

- 将原问题转换为 对于全部 (2n)! 种情况，每种情况对ans的贡献为 D^k，其中k表示该情况下有k对情侣座位相邻。

 

- 预处理好共有 i (1<=i<=N)对情侣时，出现 j (0<=j<=i) 对情侣坐在一起时情况数，用dp[i][j]记录
- 初始条件为dp[1][1]=2
- 当总情侣对数由 i 向 i+1 转移时，j 有四种变化的可能

1. j-1 → j : 新来的情侣“一起”插入到不打断先前情侣的“相邻”座位处 dp[i+1][j] += 2 * dp[i][j-1] * (2*i+1-(j-1))
2. j → j : 新来的情侣“一起”插入到打断先前某对情侣的“相邻”座位处 dp[i+1][j] += 2 * dp[i][j] * j ，或者“分开”插入到不打断先前情侣的“不相邻”座位处  dp[i+1][j] += 2 * dp[i][j] * C(2*i+1-j,2)
3. j+1 → j : 新来的情侣，一个插入到打断先前某对情侣的座位处，另一个插入到不打断先前情侣的座位处 dp[i+1][j] += 2 * dp[i][j+1] * (j+1)*(2*i+1-(j+1)
4. j+2 → j : 新来的情侣“分开”插入到打断先前某两对情侣的“相邻”座位处 dp[i+1][j] += 2 * dp[i][j+2] * C(j+2,2)

- 以上为预处理过程

 

- 最后 ans += d^i * dp[n][i] ，i=0→n